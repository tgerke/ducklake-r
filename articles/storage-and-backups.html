<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Storage and Backup Management • ducklake</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Storage and Backup Management">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ducklake</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ducklake.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ducklake.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Use Cases</h6></li>
    <li><a class="dropdown-item" href="../articles/clinical-trial-datalake.html">Clinical Trial Data Lake</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Operations</h6></li>
    <li><a class="dropdown-item" href="../articles/modifying-tables.html">Modifying Tables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Features</h6></li>
    <li><a class="dropdown-item" href="../articles/transactions.html">Working with Transactions</a></li>
    <li><a class="dropdown-item" href="../articles/time-travel.html">Time Travel Queries</a></li>
    <li><a class="dropdown-item" href="../articles/storage-and-backups.html">Storage and Backup Management</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tgerke/ducklake-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Storage and Backup Management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tgerke/ducklake-r/blob/main/vignettes/storage-and-backups.Rmd" class="external-link"><code>vignettes/storage-and-backups.Rmd</code></a></small>
      <div class="d-none name"><code>storage-and-backups.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tgerke.github.io/ducklake-r/">ducklake</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Understanding how DuckLake stores and manages your data is crucial
for maintaining a robust data lake. This vignette explains:</p>
<ul>
<li>The two-component architecture of DuckLake (catalog and
storage)</li>
<li>What types of files are created and how to inspect them</li>
<li>Best practices for choosing storage locations</li>
<li>How to implement backup and recovery strategies</li>
</ul>
</div>
<div class="section level2">
<h2 id="ducklakes-two-component-architecture">DuckLake’s Two-Component Architecture<a class="anchor" aria-label="anchor" href="#ducklakes-two-component-architecture"></a>
</h2>
<p>DuckLake separates data management into two distinct components:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Catalog (Metadata)</strong>: A database file (DuckDB,
SQLite, or PostgreSQL) that stores all metadata about your tables,
snapshots, transactions, and data file locations. This is typically
small but critically important.</p></li>
<li><p><strong>Storage (Data Files)</strong>: A directory containing
immutable Parquet files that hold your actual data. DuckLake never
modifies existing files—it only creates new ones.</p></li>
</ol>
<p>This separation provides several benefits:</p>
<ul>
<li>
<strong>Simplified consistency</strong>: Since files are never
modified, caching and replication are straightforward</li>
<li>
<strong>Flexible storage options</strong>: Store metadata locally
and data in the cloud, or vice versa</li>
<li>
<strong>Independent backup strategies</strong>: Each component can
be backed up differently based on your needs</li>
</ul>
</div>
<div class="section level2">
<h2 id="storage-options">Storage Options<a class="anchor" aria-label="anchor" href="#storage-options"></a>
</h2>
<p>DuckLake works with any filesystem backend that DuckDB supports,
including:</p>
<ul>
<li>
<strong>Local files and folders</strong>: Fast access, ideal for
single-machine workflows</li>
<li>
<strong>Cloud object storage</strong>:
<ul>
<li>AWS S3 (and S3-compatible services like Cloudflare R2, MinIO)</li>
<li>Google Cloud Storage</li>
<li>Azure Blob Storage</li>
</ul>
</li>
<li>
<strong>Network-attached storage</strong>: NFS, SMB, FUSE-based
filesystems</li>
</ul>
<div class="section level3">
<h3 id="storage-patterns">Storage Patterns<a class="anchor" aria-label="anchor" href="#storage-patterns"></a>
</h3>
<p>Here are how some common storage patterns may look:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Local storage - fastest, but not shared</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"local_lake"</span>,</span>
<span>  lake_path <span class="op">=</span> <span class="st">"~/data/my_ducklake"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cloud storage - scalable, accessible from anywhere</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"cloud_lake"</span>,</span>
<span>  lake_path <span class="op">=</span> <span class="st">"s3://my-bucket/ducklake"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://my-bucket/ducklake/data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Hybrid approach - metadata local, data in cloud</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"hybrid_lake"</span>,</span>
<span>  lake_path <span class="op">=</span> <span class="st">"~/data/metadata"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://my-bucket/data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Key considerations:</strong></p>
<ul>
<li>
<strong>Latency vs. accessibility</strong>: Local storage is fast
but not shareable; cloud storage is accessible but has higher
latency</li>
<li>
<strong>Scalability vs. cost</strong>: Object stores scale easily
but may charge for data transfer</li>
<li>
<strong>Security</strong>: Consider using DuckLake’s encryption
features for cloud storage</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="inspecting-ducklake-files">Inspecting DuckLake Files<a class="anchor" aria-label="anchor" href="#inspecting-ducklake-files"></a>
</h2>
<p>Let’s create a sample DuckLake and explore what files it
generates:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a temporary directory for our demo</span></span>
<span><span class="va">lake_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"storage_demo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">lake_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install ducklake extension</span></span>
<span><span class="fu"><a href="../reference/install_ducklake.html">install_ducklake</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create and populate a DuckLake</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"demo_lake"</span>,</span>
<span>  lake_path <span class="op">=</span> <span class="va">lake_dir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add some data with transactions</span></span>
<span><span class="fu"><a href="../reference/with_transaction.html">with_transaction</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/create_table.html">create_table</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">]</span>, <span class="st">"cars"</span><span class="op">)</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Demo User"</span>,</span>
<span>  commit_message <span class="op">=</span> <span class="st">"Initial load"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Transaction started</span></span>
<span><span class="co">#&gt; Transaction committed</span></span>
<span><span class="co">#&gt; Snapshot metadata updated</span></span>
<span></span>
<span><span class="fu"><a href="../reference/with_transaction.html">with_transaction</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/get_ducklake_table.html">get_ducklake_table</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hp_per_cyl <span class="op">=</span> <span class="va">hp</span> <span class="op">/</span> <span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/replace_table.html">replace_table</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Demo User"</span>,</span>
<span>  commit_message <span class="op">=</span> <span class="st">"Add hp_per_cyl metric"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Transaction started</span></span>
<span><span class="co">#&gt; Transaction committed</span></span>
<span><span class="co">#&gt; Snapshot metadata updated</span></span>
<span></span>
<span><span class="fu"><a href="../reference/with_transaction.html">with_transaction</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/get_ducklake_table.html">get_ducklake_table</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mpg_adjusted <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op">==</span> <span class="fl">4</span>, <span class="va">mpg</span> <span class="op">*</span> <span class="fl">1.1</span>, <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/replace_table.html">replace_table</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Demo User"</span>,</span>
<span>  commit_message <span class="op">=</span> <span class="st">"Add adjusted MPG for 4-cylinder cars"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Transaction started</span></span>
<span><span class="co">#&gt; Transaction committed</span></span>
<span><span class="co">#&gt; Snapshot metadata updated</span></span></code></pre></div>
<div class="section level3">
<h3 id="catalog-files">Catalog Files<a class="anchor" aria-label="anchor" href="#catalog-files"></a>
</h3>
<p>The catalog is a single database file containing all metadata:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">lake_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/tmp/RtmpkNyYFK/storage_demo</span></span></span>
<span><span class="co">#&gt; ├── demo_lake.ducklake</span></span>
<span><span class="co">#&gt; ├── demo_lake.ducklake.wal</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">main</span></span></span>
<span><span class="co">#&gt;     └── <span style="color: #0000BB; font-weight: bold;">cars</span></span></span>
<span><span class="co">#&gt;         ├── ducklake-019c4386-fe7b-7cec-aca7-8e7e2759e919.parquet</span></span>
<span><span class="co">#&gt;         ├── ducklake-019c4386-ff5d-7f33-9834-5c865082f6d3.parquet</span></span>
<span><span class="co">#&gt;         └── ducklake-019c4386-ffac-7250-8f01-9cdf9190d845.parquet</span></span></code></pre></div>
<p>The catalog files (<code>demo_lake.ducklake</code> and
<code>.wal</code>) contain all metadata about tables, snapshots, and
transactions.</p>
</div>
<div class="section level3">
<h3 id="storage-data-files">Storage (Data) Files<a class="anchor" aria-label="anchor" href="#storage-data-files"></a>
</h3>
<p>Data files are stored in Parquet format in a structured
directory:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data files are organized by schema and table</span></span>
<span><span class="va">main_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"main"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">main_dir</span>, recurse <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/tmp/RtmpkNyYFK/storage_demo/main</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">cars</span></span></span>
<span><span class="co">#&gt;     ├── ducklake-019c4386-fe7b-7cec-aca7-8e7e2759e919.parquet</span></span>
<span><span class="co">#&gt;     ├── ducklake-019c4386-ff5d-7f33-9834-5c865082f6d3.parquet</span></span>
<span><span class="co">#&gt;     └── ducklake-019c4386-ffac-7250-8f01-9cdf9190d845.parquet</span></span>
<span>  </span>
<span><span class="co"># Get details about parquet files</span></span>
<span><span class="va">parquet_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html" class="external-link">dir_ls</a></span><span class="op">(</span><span class="va">main_dir</span>, recurse <span class="op">=</span> <span class="cn">TRUE</span>, regexp <span class="op">=</span> <span class="st">"\\.parquet$"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">parquet_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s (%s bytes)\n"</span>, </span>
<span>              <span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_file</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   ducklake-019c4386-fe7b-7cec-aca7-8e7e2759e919.parquet (2271 bytes)</span></span>
<span><span class="co">#&gt;   ducklake-019c4386-ff5d-7f33-9834-5c865082f6d3.parquet (2462 bytes)</span></span>
<span><span class="co">#&gt;   ducklake-019c4386-ffac-7250-8f01-9cdf9190d845.parquet (2682 bytes)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-file-organization">Understanding File Organization<a class="anchor" aria-label="anchor" href="#understanding-file-organization"></a>
</h3>
<p>Each table’s data is organized by schema and table, with each
transaction creating new Parquet files:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List all snapshots to see the version history</span></span>
<span><span class="va">snapshots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_table_snapshots.html">list_table_snapshots</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span></span>
<span><span class="va">snapshots</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">snapshot_id</span>, <span class="va">author</span>, <span class="va">commit_message</span><span class="op">)</span></span>
<span><span class="co">#&gt;   snapshot_id    author                       commit_message</span></span>
<span><span class="co">#&gt; 2           1 Demo User                         Initial load</span></span>
<span><span class="co">#&gt; 3           2 Demo User                Add hp_per_cyl metric</span></span>
<span><span class="co">#&gt; 4           3 Demo User Add adjusted MPG for 4-cylinder cars</span></span></code></pre></div>
<p>The key insight is that <strong>DuckLake never modifies or deletes
existing Parquet files</strong>. Each change creates new files,
preserving the complete history for time travel queries.</p>
</div>
</div>
<div class="section level2">
<h2 id="backup-strategies">Backup Strategies<a class="anchor" aria-label="anchor" href="#backup-strategies"></a>
</h2>
<div class="section level3">
<h3 id="backing-up-the-catalog">Backing Up the Catalog<a class="anchor" aria-label="anchor" href="#backing-up-the-catalog"></a>
</h3>
<p>The catalog is the most critical component—it maps snapshots to data
files. Regular backups are essential.</p>
<div class="section level4">
<h4 id="simple-file-copy">Simple File Copy<a class="anchor" aria-label="anchor" href="#simple-file-copy"></a>
</h4>
<p>For local databases, the simplest backup is a file copy:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create backup directory</span></span>
<span><span class="va">backup_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">backup_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Copy the catalog file to create a backup</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"demo_lake.ducklake"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">backup_dir</span>, <span class="st">"demo_lake.ducklake"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Copy the data directory as well</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">dir_copy</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"main"</span><span class="op">)</span>,</span>
<span>  new_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">backup_dir</span>, <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify the backup was created</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">backup_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/tmp/RtmpkNyYFK/storage_demo/backups</span></span></span>
<span><span class="co">#&gt; ├── demo_lake.ducklake</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">main</span></span></span>
<span><span class="co">#&gt;     └── <span style="color: #0000BB; font-weight: bold;">cars</span></span></span>
<span><span class="co">#&gt;         ├── ducklake-019c4386-fe7b-7cec-aca7-8e7e2759e919.parquet</span></span>
<span><span class="co">#&gt;         ├── ducklake-019c4386-ff5d-7f33-9834-5c865082f6d3.parquet</span></span>
<span><span class="co">#&gt;         └── ducklake-019c4386-ffac-7250-8f01-9cdf9190d845.parquet</span></span>
<span></span>
<span><span class="co"># To use the backup, detach the current lake and attach to the backup</span></span>
<span><span class="co"># First detach the original</span></span>
<span><span class="fu"><a href="../reference/detach_ducklake.html">detach_ducklake</a></span><span class="op">(</span><span class="st">"demo_lake"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Attach to the backup location</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"demo_lake"</span>,</span>
<span>  lake_path <span class="op">=</span> <span class="va">backup_dir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify you're working with the backup</span></span>
<span><span class="fu"><a href="../reference/list_table_snapshots.html">list_table_snapshots</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   snapshot_id       snapshot_time schema_version</span></span>
<span><span class="co">#&gt; 2           1 2026-02-09 17:50:46              1</span></span>
<span><span class="co">#&gt; 3           2 2026-02-09 17:50:46              2</span></span>
<span><span class="co">#&gt; 4           3 2026-02-09 17:50:46              3</span></span>
<span><span class="co">#&gt;                                                                 changes</span></span>
<span><span class="co">#&gt; 2                    tables_created, tables_inserted_into, main.cars, 1</span></span>
<span><span class="co">#&gt; 3 tables_created, tables_dropped, tables_inserted_into, main.cars, 1, 2</span></span>
<span><span class="co">#&gt; 4 tables_created, tables_dropped, tables_inserted_into, main.cars, 2, 3</span></span>
<span><span class="co">#&gt;      author                       commit_message commit_extra_info</span></span>
<span><span class="co">#&gt; 2 Demo User                         Initial load              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 Demo User                Add hp_per_cyl metric              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 Demo User Add adjusted MPG for 4-cylinder cars              &lt;NA&gt;</span></span>
<span></span>
<span><span class="co"># You can switch back to the original by detaching and reattaching</span></span>
<span><span class="fu"><a href="../reference/detach_ducklake.html">detach_ducklake</a></span><span class="op">(</span><span class="st">"demo_lake"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span><span class="st">"demo_lake"</span>, lake_path <span class="op">=</span> <span class="va">lake_dir</span><span class="op">)</span></span></code></pre></div>
<p><strong>Important</strong>: Transactions committed after a backup
won’t be tracked when recovering. The data will exist in the Parquet
files, but the backup will point to an earlier snapshot.</p>
<p><strong>Best practices:</strong></p>
<ul>
<li>Back up after batch jobs complete</li>
<li>For streaming/continuous updates, schedule periodic backups</li>
<li>Consider using <a href="https://github.com/bnosac/cronR" class="external-link">cronR</a> or <a href="https://github.com/bnosac/taskscheduleR" class="external-link">taskscheduleR</a>
for automated backups</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="backing-up-storage-data-files">Backing Up Storage (Data Files)<a class="anchor" aria-label="anchor" href="#backing-up-storage-data-files"></a>
</h3>
<p>Since Parquet files are immutable, backing up storage is
straightforward.</p>
<div class="section level4">
<h4 id="local-storage-backup">Local Storage Backup<a class="anchor" aria-label="anchor" href="#local-storage-backup"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use file system tools to copy the entire data directory</span></span>
<span><span class="va">backup_data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span>, <span class="st">"main_backup"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">dir_copy</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"main"</span><span class="op">)</span>,</span>
<span>  new_path <span class="op">=</span> <span class="va">backup_data_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cloud-storage-backup">Cloud Storage Backup<a class="anchor" aria-label="anchor" href="#cloud-storage-backup"></a>
</h4>
<p>For cloud storage, use provider-specific mechanisms:</p>
<p><strong>AWS S3:</strong> - Cross-bucket replication (copies to a
different bucket automatically) - AWS Backup service (scheduled backups
within the same bucket) - S3 versioning (keeps previous versions of
objects)</p>
<p><strong>Google Cloud Storage:</strong> - Cross-bucket replication -
Backup and DR service - Object versioning with soft deletes</p>
<p>When using cross-bucket replication, update your data path:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"prod_lake"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://original-bucket/data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># After recovery from replicated bucket</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"prod_lake"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://backup-bucket/data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="recovery-procedures">Recovery Procedures<a class="anchor" aria-label="anchor" href="#recovery-procedures"></a>
</h2>
<div class="section level3">
<h3 id="recovering-from-catalog-backup">Recovering from Catalog Backup<a class="anchor" aria-label="anchor" href="#recovering-from-catalog-backup"></a>
</h3>
<p>If your catalog is corrupted or lost:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restore from backup by copying the backup file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span>, </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"demo_lake_backup_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".ducklake"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"demo_lake.ducklake"</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reattach to the restored database</span></span>
<span><span class="fu"><a href="../reference/attach_ducklake.html">attach_ducklake</a></span><span class="op">(</span><span class="st">"demo_lake"</span>, lake_path <span class="op">=</span> <span class="va">lake_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify recovery by listing snapshots</span></span>
<span><span class="fu"><a href="../reference/list_table_snapshots.html">list_table_snapshots</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recovering-from-data-file-loss">Recovering from Data File Loss<a class="anchor" aria-label="anchor" href="#recovering-from-data-file-loss"></a>
</h3>
<p>If data files are lost but the catalog is intact:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restore data files from backup</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">dir_copy</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">backup_data_dir</span>,</span>
<span>  new_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"main"</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DuckLake will automatically reconnect to the restored files</span></span>
<span><span class="co"># since the catalog maintains the file paths</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="maintenance-considerations">Maintenance Considerations<a class="anchor" aria-label="anchor" href="#maintenance-considerations"></a>
</h2>
<p>When planning backups, coordinate with maintenance operations:</p>
<ul>
<li>
<strong>Compaction</strong> (merging adjacent files): Run before
backups to ensure consistent file layout</li>
<li>
<strong>Cleanup</strong> (removing obsolete files): Run before
backups to avoid backing up unnecessary files</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recommended backup sequence</span></span>
<span></span>
<span><span class="co"># 1. Run maintenance operations (if needed)</span></span>
<span><span class="co"># See maintenance vignettes for details</span></span>
<span></span>
<span><span class="co"># 2. Ensure all transactions are committed</span></span>
<span><span class="co"># (no pending work)</span></span>
<span></span>
<span><span class="co"># 3. Back up catalog</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"demo_lake.ducklake"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span>, </span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"backup_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d_%H%M%S"</span><span class="op">)</span>, <span class="st">".ducklake"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Back up data files</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">dir_copy</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"main"</span><span class="op">)</span>,</span>
<span>  new_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span>, <span class="st">"main_latest"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="complete-backup-example">Complete Backup Example<a class="anchor" aria-label="anchor" href="#complete-backup-example"></a>
</h2>
<p>DuckLake provides a convenient <code><a href="../reference/backup_ducklake.html">backup_ducklake()</a></code>
function for creating timestamped backups:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a complete backup with timestamp</span></span>
<span><span class="va">backup_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backup_ducklake.html">backup_ducklake</a></span><span class="op">(</span></span>
<span>  ducklake_name <span class="op">=</span> <span class="st">"demo_lake"</span>,</span>
<span>  lake_path <span class="op">=</span> <span class="va">lake_dir</span>,</span>
<span>  backup_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_dir</span>, <span class="st">"backups"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Catalog backed up successfully</span></span>
<span><span class="co">#&gt; Data files backed up successfully</span></span>
<span><span class="co">#&gt; Backup completed: /tmp/RtmpkNyYFK/storage_demo/backups/backup_20260209_175047</span></span>
<span></span>
<span><span class="co"># The function returns the backup directory path</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">backup_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpkNyYFK/storage_demo/backups/backup_20260209_175047"</span></span></code></pre></div>
<p>The <code><a href="../reference/backup_ducklake.html">backup_ducklake()</a></code> function: - Creates a timestamped
backup directory - Copies the catalog database file - Copies all data
files from the main/ directory - Returns the backup directory path for
reference</p>
</div>
<div class="section level2">
<h2 id="cleanup">Cleanup<a class="anchor" aria-label="anchor" href="#cleanup"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detach the demo lake</span></span>
<span><span class="fu"><a href="../reference/detach_ducklake.html">detach_ducklake</a></span><span class="op">(</span><span class="st">"demo_lake"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up temporary files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">lake_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Key takeaways for managing DuckLake storage and backups:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Understand the architecture</strong>: Catalog (metadata) and
storage (data) are separate components</li>
<li>
<strong>Choose storage wisely</strong>: Balance latency,
scalability, cost, and accessibility</li>
<li>
<strong>Files are immutable</strong>: DuckLake never modifies
existing Parquet files</li>
<li>
<strong>Back up regularly</strong>: Catalog backups are critical;
back up after batch jobs</li>
<li>
<strong>Coordinate with maintenance</strong>: Run compaction and
cleanup before backups</li>
<li>
<strong>Test recovery procedures</strong>: Ensure you can actually
restore from backups</li>
</ol>
<p>For production systems, consider:</p>
<ul>
<li>Automated backup scheduling (using <a href="https://github.com/bnosac/cronR" class="external-link">cronR</a> or
<a href="https://github.com/bnosac/taskscheduleR" class="external-link">taskscheduleR</a>)</li>
<li>Multiple backup locations (local and cloud)</li>
<li>Testing recovery procedures regularly</li>
<li>Monitoring backup success and storage usage</li>
<li>Version control for catalog schema changes</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Travis Gerke.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
